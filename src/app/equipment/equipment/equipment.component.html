<div
     class="table-responsive-sm table-responsive-md table-responsive-lg table-responsive-xl">
  <div *ngIf="service.errors.hasFatalError"
       class="alert alert-danger">
    <div [innerHTML]="service.errors.fatalError"></div>
  </div>
  <div *ngIf="service.errors.hasMessage"
       class="alert alert-warning">
    <div>{{service.errors.message}}</div>
  </div>
  <div *ngIf="service.errors.hasErrors['validate']">
    <div *ngFor="let child of service.errors.errors['validate'].errors">
      {{child}}
    </div>
  </div>
  <fieldset [disabled]="service.loading">
    <app-equipment-filter #equipmentFilter></app-equipment-filter>

    <app-validation-and-search class="d-block d-sm-block d-md-block d-lg-block d-xl-none"
                               [service]="service"></app-validation-and-search>
    <div class="d-flex justify-content-between align-items-center">
      <button class="btn btn-light btn-sm d-flex justify-content-center align-content-between"
              *ngIf="!service.isValidator"
              (click)="equipmentUpdate.create()">
        <mat-icon [inline]="true">add</mat-icon>
      </button>
      <app-validation-and-search class="d-none d-sm-none d-md-none d-lg-none d-xl-block"
                                 [service]="service">
      </app-validation-and-search>
      <app-pagination [pagination]="service"></app-pagination>
    </div>
    <table class="table">
      <thead>
        <tr>
          <th scope="col"
              class="col-md-2 col-sm-9 col-xs-9 pointer"
              (click)="service.sortByOrOrient(sortByEnum.name)">
            <div class="d-flex">Name
              <div *ngIf="service.sortBy === sortByEnum.name">
                <mat-icon *ngIf="service.sort === sortEnum.asc">arrow_drop_down
                </mat-icon>
                <mat-icon *ngIf="service.sort === sortEnum.desc">arrow_drop_up
                </mat-icon>
              </div>
            </div>
          </th>
          <th scope="col"
              class="col-md-4 d-none d-sm-table-cell pointer"
              (click)="service.sortByOrOrient(sortByEnum.description)">
            <div class="d-flex">Description
              <div *ngIf="service.sortBy === sortByEnum.description">
                <mat-icon *ngIf="service.sort === sortEnum.asc">arrow_drop_down
                </mat-icon>
                <mat-icon *ngIf="service.sort === sortEnum.desc">arrow_drop_up
                </mat-icon>
              </div>
            </div>
          </th>
          <th scope="col"
              class="col-md-1 d-none d-sm-table-cell d-md-table-cell pointer"
              (click)="service.sortByOrOrient(sortByEnum.brand)">
            <div class="d-flex">Brand
              <div *ngIf="service.sortBy === sortByEnum.brand">
                <mat-icon *ngIf="service.sort === sortEnum.asc">arrow_drop_down
                </mat-icon>
                <mat-icon *ngIf="service.sort === sortEnum.desc">arrow_drop_up
                </mat-icon>
              </div>
            </div>
          </th>
          <th scope="col"
              class="col-md-2 d-none d-sm-table-cell d-md-table-cell pointer"
              (click)="service.sortByOrOrient(sortByEnum.subCategory)">
            <div class="d-flex">Sub-category
              <div *ngIf="service.sortBy === sortByEnum.subCategory">
                <mat-icon *ngIf="service.sort === sortEnum.asc">arrow_drop_down
                </mat-icon>
                <mat-icon *ngIf="service.sort === sortEnum.desc">arrow_drop_up
                </mat-icon>
              </div>
            </div>
          </th>
          <th scope="col"
              class="col-1 col-sm-1 col-xs-1 pointer"
              (click)="service.sortByOrOrient(sortByEnum.weight)">
            <div class="d-flex">Weight
              <div *ngIf="service.sortBy === sortByEnum.weight">
                <mat-icon *ngIf="service.sort === sortEnum.asc">arrow_drop_down
                </mat-icon>
                <mat-icon *ngIf="service.sort === sortEnum.desc">arrow_drop_up
                </mat-icon>
              </div>
            </div>
          </th>
          <th scope="col"
              class="col-1 col-sm-1 col-xs-1 pointer"
              (click)="service.sortByOrOrient(sortByEnum.price)">
            <div class="d-flex">Price
              <div *ngIf="service.sortBy === sortByEnum.price">
                <mat-icon *ngIf="service.sort === sortEnum.asc">arrow_drop_down
                </mat-icon>
                <mat-icon *ngIf="service.sort === sortEnum.desc">arrow_drop_up
                </mat-icon>
              </div>
            </div>
          </th>
          <th scope="col"
              class="col-1 col-sm-1 col-xs-1">Own<br />Whishes</th>
        </tr>
      </thead>
      <ng-container *ngFor="let equipment of service.values">
        <tr (click)="service.setSelected(equipment)"
            (dblclick)="updateDblClick(equipment)"
            [class.active]="equipment == service.selected"
            class="pointer">
          <td class=""><b>{{equipment.name}}</b>
          </td>
          <td class="d-none d-sm-table-cell">
            <p>
              {{equipment.description | slice:0:75}}{{equipment.description.length > 75 ? '...' : ''}}
            </p>
          </td>
          <td class="d-none d-sm-table-cell d-md-table-cell">
            <img [src]="equipment.brand?.logo.url()"
                 *ngIf="equipment.brand?.logo.hasUrl() || false"
                 class="img-thumbnail rounded mx-auto d-block" />
            <p *ngIf="!equipment.brand?.logo.hasUrl() || false">
              {{equipment.brand?.name || ''}}</p>
          </td>
          <td class="d-none d-sm-table-cell d-md-table-cell">
            {{equipment.subCategory.name}}</td>
          <td class="">{{equipment.compute('weight')}}g</td>
          <td class="">{{equipment.compute('price')}}</td>
          <td class="">
            <div class="btn-group"
                 role="group"
                 aria-label="Tools">
              <button type="button"
                      class="btn btn-light btn-sm d-flex justify-content-center align-content-between"
                      *ngIf="canEditOrDelete(equipment)"
                      (click)="equipmentUpdate.update(equipment)">
                <mat-icon [inline]="true">update</mat-icon>
              </button>
              <button type="button"
                      class="btn btn-light btn-sm d-flex justify-content-center align-content-between"
                      *ngIf="canEditOrDelete(equipment)"
                      (click)="equipmentUpdate.onDelete(equipment)">
                <mat-icon [inline]="true">delete</mat-icon>
              </button>
            </div>
            <div class="btn-group"
                 role="group">
              <app-switch [value]="equipment.askValidate"
                          [disabled]="service.loading"
                          *ngIf="!equipment.validate"
                          (isChecked)="service.updateAskValidate(equipment)">
              </app-switch>
              <button class="btn btn-light btn-sm d-flex justify-content-center align-content-between"
                      (click)="haveOwnedModal.open(equipment)">
                <mat-icon (click)="haveOwnedModal.open(equipment)"
                          [inline]="true"
                          *ngIf="!equipment.has">add</mat-icon>
                <mat-icon (click)="haveOwnedModal.open(equipment)"
                          [inline]="true"
                          *ngIf="equipment.has">add_shopping_cart</mat-icon>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="service.selected === equipment">
          <td colspan="7">
            <app-characteristic [parentData]="equipment"
                                (create)="characteristicModal.create(equipment)"
                                (update)="characteristicModal.update(equipment, $event)"
                                (delete)="characteristicModal.delete(equipment, $event)">
            </app-characteristic>
          </td>
        </tr>
      </ng-container>
    </table>
    <app-pagination [pagination]="service"></app-pagination>
  </fieldset>
  <div *ngIf="service.errors.hasFatalError"
       class="alert alert-danger">
    <div [innerHTML]="service.errors.fatalError"></div>
  </div>
  <div *ngIf="service.errors.hasMessage"
       class="alert alert-warning">
    <div>{{service.errors.message}}</div>
  </div>
  <div *ngIf="service.errors.hasErrors['validate']">
    <div *ngFor="let child of service.errors.errors['validate'].errors">
      {{child}}
    </div>
  </div>
</div>
<app-user-owned-update #haveOwnedModal
                       (done)="onDoneHave($event)"></app-user-owned-update>

<app-equipment-update #equipmentUpdate
                      [equipments]="service.values"
                      [characteristicModal]="characteristicModal"
                      (updateDone)="service.valueAdded($event)">
</app-equipment-update>

<app-characteristic-update #characteristicModal>
</app-characteristic-update>
