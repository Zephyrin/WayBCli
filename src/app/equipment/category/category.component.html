<div
     class="table-responsive-sm table-responsive-md table-responsive-lg table-responsive-xl">
  <div *ngIf="service.errors.hasFatalError"
       class="alert alert-danger">
    <div [innerHTML]="service.errors.fatalError"></div>
  </div>
  <div *ngIf="service.errors.hasMessage"
       class="alert alert-warning">
    <div>{{service.errors.message}}</div>
  </div>
  <div *ngIf="service.errors.hasErrors['validate']">
    <div *ngFor="let child of service.errors.errors['name'].errors">
      {{child}}
    </div>
  </div>
  <fieldset [disabled]="service.loading">
    <app-validation-and-search [service]="service"
                               class="d-block d-sm-block d-md-block d-lg-block d-xl-none">
    </app-validation-and-search>

    <div class="d-flex justify-content-between align-items-center">
      <button class="btn btn-light btn-sm d-flex justify-content-center align-content-between"
              *ngIf="!isValidator"
              (click)="categoryModal.open()">
        <mat-icon [inline]="true">add</mat-icon>
      </button>
      <app-validation-and-search [service]="service"
                                 class="d-none d-sm-none d-md-none d-lg-none d-xl-block">
      </app-validation-and-search>
      <app-pagination [pagination]="service"></app-pagination>
    </div>
    <table class="table">
      <thead>
        <tr>
          <th scope="col"
              class="col-8 align-middle pointer"
              (click)="service.sortByOrOrient(sortByEnum.name)">
            <div class="d-flex">Category name
              <div *ngIf="service.sortBy === sortByEnum.name">
                <mat-icon *ngIf="service.sort === sortEnum.asc">arrow_drop_down
                </mat-icon>
                <mat-icon *ngIf="service.sort === sortEnum.desc">arrow_drop_up
                </mat-icon>
              </div>
            </div>
          </th>
          <th scope="col"
              class="col-2 align-middle pointer"
              (click)="service.sortByOrOrient(sortByEnum.subCategoryCount)">
            <div class="d-flex">Sub-categories count
              <div *ngIf="service.sortBy === sortByEnum.subCategoryCount">
                <mat-icon *ngIf="service.sort === sortEnum.asc">arrow_drop_down
                </mat-icon>
                <mat-icon *ngIf="service.sort === sortEnum.desc">arrow_drop_up
                </mat-icon>
              </div>
            </div>
          </th>
          <th scope="col"
              class="col-1 align-middle pointer"
              (click)="service.sortByOrOrient(sortByEnum.askValidate)"
              *ngIf="isValidator">
            <div class="d-flex">Ask Validation
              <div *ngIf="service.sortBy === sortByEnum.askValidate">
                <mat-icon *ngIf="service.sort === sortEnum.asc">arrow_drop_down
                </mat-icon>
                <mat-icon *ngIf="service.sort === sortEnum.desc">arrow_drop_up
                </mat-icon>
              </div>
            </div>
          </th>
          <th scope="col align-middle"
              class="col-1 action align-middle pointer"
              (click)="service.sortByOrOrient(isValidator ? sortByEnum.askValidate : sortByEnum.validate)">
            <div class="d-flex">Action
              <div
                   *ngIf="(isValidator && service.sortBy === sortByEnum.askValidate)
                          || (!isValidator && service.sortBy === sortByEnum.validate)">
                <mat-icon *ngIf="service.sort === sortEnum.asc">arrow_drop_down
                </mat-icon>
                <mat-icon *ngIf="service.sort === sortEnum.desc">arrow_drop_up
                </mat-icon>
              </div>
            </div>
          </th>
        </tr>
      </thead>
      <ng-container *ngFor="let category of service.values">
        <tr (click)="setSelected(category)"
            (dblclick)="dblClick(category)"
            [class.active]="category === service.selected"
            class="pointer">
          <td class="col-8 align-middle">
            <b>{{category.name}}</b>
          </td>
          <td class="col-2 align-middle">{{category.subCategories.length}}</td>
          <td class="col-1 align-middle"
              *ngIf="isValidator">
            <app-switch [value]="category.askValidate"
                        [disabled]="true"></app-switch>
          </td>
          <td class="col-1 action align-middle">
            <div class="btn-group d-flex justify-content-center align-content-between"
                 role="group"
                 *ngIf="service.canEditOrDelete(category)"
                 aria-label="Tools">
              <button type="button"
                      class="btn btn-light btn-sm d-flex justify-content-center align-content-between"
                      (click)="categoryModal.open(category)">
                <mat-icon [inline]="true">update</mat-icon>
              </button>
              <button type="button"
                      class="btn btn-light btn-sm d-flex justify-content-center align-content-between"
                      (click)="categoryModal.onDelete(category)">
                <mat-icon [inline]="true">delete</mat-icon>
              </button>
              <app-switch [value]="category.askValidate"
                          [disabled]="service.loading"
                          (isChecked)="service.updateAskValidate(category)">
              </app-switch>
            </div>
          </td>
        </tr>
        <tr *ngIf="service.selected === category">
          <td colspan="4">
            <app-sub-category [subCategories]="category.subCategories"
                              [parent]="category"
                              [isValidator]="service.isValidator"
                              [loadingParent]="service.loading"
                              [subCategoryModal]="subCategoryModal">
            </app-sub-category>
          </td>
        </tr>
      </ng-container>
    </table>
    <app-pagination [pagination]="service"></app-pagination>
  </fieldset>
  <div *ngIf="service.errors.hasFatalError"
       class="alert alert-danger">
    <div [innerHTML]="service.errors.fatalError"></div>
  </div>
  <div *ngIf="service.errors.hasMessage"
       class="alert alert-warning">
    <div>{{service.errors.message}}</div>
  </div>
  <div *ngIf="service.errors.hasErrors['validate']">
    <div *ngFor="let child of service.errors.errors['name'].errors">
      {{child}}
    </div>
  </div>
</div>
<app-category-update #categoryModal
                     (updateDone)="service.valueAdded($event)">
</app-category-update>
<app-sub-category-update #subCategoryModal></app-sub-category-update>
